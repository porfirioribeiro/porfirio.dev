<script lang="ts">
  import formatDistanceToNow from "date-fns/formatDistanceToNow";
  import BlogMeta from "$lib/components/BlogMeta.svelte";
  import TagChips from "$lib/components/TagChips.svelte";
  import type { PageData } from "./$types";
  import Markdown from "$lib/components/Markdown.svelte";

  export let data: PageData;
</script>

<BlogMeta post={data.post} />
<svelte:head>
  {#if data.post.blocks.code}
    <link
      rel="stylesheet"
      href="https://unpkg.com/github-syntax-dark@0.5.0/lib/github-dark.css"
    />
  {/if}
  {#if data.post.blocks.twitter}
    <script
      async
      src="https://platform.twitter.com/widgets.js"
      charset="utf-8"
    ></script>
  {/if}
</svelte:head>

<article>
  <h1>{data.post.title}</h1>
  <Markdown body={data.post.body} />

  <div>
    <time>{data.post.created_at}</time>
    <TagChips tags={data.post.tags} />
  </div>
</article>

<section>
  {#each data.comments as comment}
    <article>
      <a href={comment.author.ghUrl}>
        <img src={comment.author.avatar} alt={comment.author.name} width="32" />
      </a>
      <a href={comment.ghUrl}>
        <time>
          {formatDistanceToNow(new Date(comment.created_at), {
            addSuffix: true,
            includeSeconds: true,
          })}
        </time>
      </a>

      <Markdown body={comment.body} />
    </article>
  {/each}
</section>

<style lang="scss">
  section {
    margin-top: 2rem;
    article {
      border: 1px solid white;
      padding: 1rem;
    }
  }
</style>
